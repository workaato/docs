 # アプリ接続

::: tip SUMMARY
- Workatoは、レシピを構築するためにアプリと接続し、各接続は複数のレシピで再利用できます。
- 接続には「接続の作成」特権が必要であり、OAuthや基本認証などのさまざまな方法を使用してアプリの認証APIを使用します。
- Workatoのデータアクセスはユーザーの権限に関連付けられており、接続はレシピエディタ内または接続ウィザードを介して作成できます。
- 複数のアプリインスタンスには異なる接続が必要です。
:::

::: details クイックビデオガイドを見る

<Video src="https://www.youtube.com/embed/m3lajUatO7w" />

:::

レシピの構築を開始する際には、Workatoとアプリの間に接続を確立する必要があります。

各接続は、ユーザーアカウントなどのアプリのインスタンスに関連付けられ、複数のレシピで再利用できます。

このガイドでは、以下の内容を説明します：

- [接続の基本](#connection-basics)
- [接続の作成](#creating-connections)
- [レシピでの接続の使用](#using-connections-in-recipes)
- [接続エラーの処理方法](#connection-errors)

---

## 接続の基本

- [誰が接続を作成できるのか？](#who-can-create-connections)
- [Workatoはどのように接続にアクセスするのか？](#how-does-workato-access-my-connections)
- [Workatoは接続でどのデータにアクセスできるのか？](#what-data-can-workato-access-in-my-connections)
- [どのようなベストプラクティスを守るべきか？](#what-best-practices-should-i-follow)

### 誰が接続を作成できるのか？

接続を作成するには、[**接続の作成**特権](/ja/privileges.md#connection)が必要です。

手順については、[接続の作成](#creating-connections)セクションを参照してください。

### Workatoはどのように接続にアクセスするのか？

Workatoは通常、アプリの認証/認可APIを使用して接続を確立します。以下のいずれかの方法を使用します。

- OAuth 2.0
- OAuth 1.0（およびそのバリエーション）
- 基本認証（ユーザー名とパスワード）
- APIキーまたはシークレット

この手順の一環として、Workatoにアプリからのデータアクセスの許可を提供します。Workatoに付与される権限は通常、[アプリの認証を許可するユーザー](#what-data-can-workato-access-in-my-connections)の権限に対応しています。

Workatoに接続する方法の詳細については、アプリの[コネクタドキュメント](/ja/connectors.md)を参照してください。

### Workatoは接続でどのデータにアクセスできるのか？

Workatoは、接続を認証するユーザーがアクセスできるデータにのみアクセスできます。

例えば：Salesforceでアカウントを表示する権限しか持っていない場合、WorkatoでSalesforce接続を作成しても、Workatoはアカウントの表示しかできません。

### どのようなベストプラクティスを守るべきか？

接続を作成する際には、次のことを推奨します：

- [Workatoのための専用ユーザーの作成](#creating-a-dedicated-user-for-workato)
- [開発用のサンドボックス認証情報の使用](#using-sandbox-credentials-for-development)

#### Workatoのための専用ユーザーの作成

Workatoのために専用のアプリユーザーを作成することで、レシピが人間のユーザーアカウントに依存しないようにします。誰かが会社を去っても、レシピは引き続き実行されます。

さらに、専用のWorkatoユーザーを作成することで、Workatoがアプリ内で持つ権限を調整できるため、セキュリティリスクを低減できます。

アプリには、ユーザーの役割と権限を定義する際に異なる細かさがあります。詳細については、アプリの[コネクタドキュメント](/ja/connectors.md)を参照してください。

#### 開発用のサンドボックス認証情報の使用

開発時には、サンドボックス認証情報を使用することをおすすめします。 開発とテストのために、レシピでは接続にサンドボックス（または非本番）の資格情報を使用することをお勧めします。開発中にテストデータを使用することで、ライブデータが誤って変更されることを防ぎます。

詳細については、[レシピでの接続の使用](#using-connections-in-recipes)セクションを参照してください。

---

## 接続の作成

Workatoでアプリを接続する方法は2つあります：

- [レシピエディタで](#in-the-recipe-editor)
- [接続ウィザードで](#in-the-connection-wizard)

### レシピエディタで

レシピエディタで接続を追加するには：

<Stepper>
<Step>

レシピエディタで、サイドメニューからアプリをクリックします。

</Step>
<Step>

使用したいトリガーまたはアクションをクリックします。

</Step>
<Step>

アプリの[セットアップガイド](/ja/connectors.md)に従って、プロンプトに従います。

</Step>
</Stepper>

![新しいレシピを介した接続](@img/recipes/app-connections/via-new-recipe.gif)

### 接続ウィザードで

Workatoでは、いくつかの場所から接続ウィザードにアクセスできます：

- **リソース > 接続 > 接続の作成**
- **リソース > レシピ > 接続の作成**
- **任意のプロジェクト > 接続の作成**

![新しい接続を介した接続](@img/recipes/app-connections/via-new-connection.gif)

---

## レシピでの接続の使用

::: warning 重要！
トリガーやアクションをレシピで設定する前に、アプリへの有効な接続を確立する必要があります。
:::

- [複数のアプリインスタンス、1つのレシピ](#multiple-app-instances-one-recipe)
- [ランタイムユーザー接続](#runtime-user-connections)

### 複数のアプリインスタンス、1つのレシピ

通常、アプリのインスタンスは1つまたは2つあります。本番用のインスタンスとテスト用のインスタンスがあります。このようなシナリオでは、複数のレシピで使用するために1つの接続が必要になるでしょう。

アプリの複数のインスタンスがある場合、Workatoで複数の接続を作成する必要があります。各接続は、アプリの各インスタンスに対して認証を行います。

ほとんどのコネクタは、レシピごとにアプリごとに1つの接続しか許可しません。2つの別々のアプリインスタンスで作業する必要がある場合は、[セカンダリコネクタ](/ja/features/secondary-connectors.md)を使用できます。

::: note セカンダリコネクタ

Workatoのすべてのコネクタでセカンダリコネクタはサポートされていません。

セカンダリコネクタがサポートされていないアプリを使用する場合、レシピごとにアプリごとに1つの接続に制限されます。

同じレシピ内でアプリの複数のインスタンスに接続しようとすると、Workatoはそれを防止します。2番目の接続を作成すると、最初の接続が自動的に上書きされ、2番目の接続に置き換えられます。

たとえば、**Gmailの新しいメール**というレシピトリガーが**My Gmail account**接続を使用している場合、レシピの後続のステップでもGmailのアクションが関与する場合、同じ接続を使用する必要があります。**My second Gmail account**などの異なる接続を使用しようとすると、Workatoは**Gmailの新しいメール**トリガーの接続を**My second Gmail account**に更新します。

:::

### ランタイムユーザー接続

:::tip CALLABLE & WORKBOT RECIPESで利用可能
**ランタイムユーザー接続**機能は、CallableまたはWorkbotレシピでのみ利用可能です。
:::

デフォルトでは、レシピは接続の認証に使用された資格情報に基づいてアクションを実行します。ただし、**ランタイムユーザー接続**機能を使用することで、レシピが実行される際に接続を切り替えることができます。

例えば：Salesf ## 接続エラー

時折、アプリの接続が無効になることがあります。以下は最も一般的な理由です。

- **変更された資格情報。** アプリ内で資格情報が変更され、Workatoで変更されていない場合、接続が無効になる可能性があります。
- **不十分な権限。** この場合、接続を承認するユーザーには、必要なデータにアクセスしたり、特定の操作を実行したりするための権限がありません。

無効な接続エラーが発生した場合は、次の手順をお勧めします。

- **接続を承認するユーザーの権限を確認します。** 接続を承認するユーザーが十分な権限を持っていることを確認してください。
- **接続の資格情報が正しいことを確認します。** パスワード、APIキーなどが正しく入力されているかを再確認してください。
- **接続を再承認します。** ユーザーの権限と資格情報を確認した後、接続を再接続してみてください。

![アプリ接続エラーのデザイン時エラー](~@img/recipes/troubleshooting/connection-error.png)
*アプリ接続エラーのデザイン時エラー*

---

**Source**: [Runtime user connections docs](/ja/features/runtime-user-connections.md)