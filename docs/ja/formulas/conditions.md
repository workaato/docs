 ---
title: フォーミュラモード - フォーミュラに条件を追加する
date: 2021-06-28 00:00:00 Z
---

# フォーミュラに条件を追加する
予期しないシナリオに対応できるレシピを作成することも重要です。たとえば、トリガーデータに欠落した値が含まれていたり、別のデータ型のデータが含まれていたりするかもしれません。

これらの状況に備えて、条件付きロジックを使用することができます。

## 条件文
Rubyの三項構文（if-else文のショートカットとしてよく使われる）を使用して、条件付きでフォーミュラを実行することができます。三項構文は以下の形式です:

```
condition ? expression1 : expression2
```

### 動作
#### `condition`
`true`または`false`に評価されるブール式です。

#### `expression1`
`condition`が`true`の場合にこの式を返します。

#### `expression2`
`condition`が`false`の場合にこの式を返します。

## 例: 名前またはフルネームを使用する
以下の例では、<kbd>フルネーム</kbd>または<kbd>名前</kbd>のいずれかを条件付きで<kbd>メッセージ</kbd>入力フィールドに渡します。

![三項構文](~@img/formula-docs/ternary-formula.png)
*<kbd>フルネーム</kbd>が存在するかどうかをチェックします。存在する場合は<kbd>フルネーム</kbd>を出力し、存在しない場合は<kbd>名前</kbd>を出力します。*

以下は、三項構文のフォーミュラが行っていることの詳細な説明です:

1. <code><kbd>フルネーム</kbd>.present?</code>は、<kbd>フルネーム</kbd>の値があるかどうかをチェックします。値がある場合、`true`に評価されます。値がない場合、`false`に評価されます。
2. フォーミュラ内の最初の`?`は[`.present?`フォーミュラ](/formulas/string-formulas.md#present)の一部であり、2番目の`?`はスペース文字で区切られ、三項構文の一部です。
3. ジョブが実行されるときに<kbd>フルネーム</kbd>のピルに値がある場合、<kbd>フルネーム</kbd>の値が**メッセージ**入力にマッピングされます。
4. ジョブが実行されるときに<kbd>フルネーム</kbd>のピルに値がない場合、<kbd>名前</kbd>の値が**メッセージ**入力にマッピングされます。もちろん、この<kbd>名前</kbd>のピルにも値がない場合、**メッセージ**が必須の入力フィールドであるため、このステップでジョブは失敗します。

Rubyの三項構文の詳細については、この[記事](http://www.w3resource.com/ruby/ruby-ternary-operator.php)を参照してください。

## 例: 空の場合はフィールドをスキップする
レコードを更新する際には、更新されたフィールドのみを変更し、既存のデータを保持したいと思うことがあります。このような場合、`skip`フォーミュラを使用して、Workatoアクションにこのフィールドを変更しないように指示することができます。

この例では、更新されたSalesforceレコードを使用してMarketoのリードを更新しようとしています。Salesforceの<kbd>会社</kbd>が存在するかどうかをチェックします。存在する場合、Salesforceの<kbd>会社</kbd>をMarketoに出力します。それ以外の場合、Marketoのレコードは変更されません。

![スキップ構文](~@img/formula-docs/skip-formula.png)
*<kbd>会社</kbd>が存在するかどうかをチェックします。存在する場合は<kbd>会社</kbd>を出力し、存在しない場合はこのフィールドを変更しません。*

::: tip どの値も渡さない方法
[skipフォーミュラ](/formulas/other-formulas.md#skip)を使用すると、入力フィールドにデータを渡さないようにすることができます。
:::

## 安全なナビゲーション演算子

入力が有効かどうかをチェックします。真の場合、指定された操作を入力データに対して実行します。それ以外の場合、`null`値を返します。

### 構文

<kbd>Input</kbd>&.<span style="color:#FF0000">operation</span>

- <kbd>Input</kbd> - 入力データピル。任意のデータ型であることができます。
- <span style="color:#FF0000">operation</span> > - もし入力が `null` でない場合、この式は入力データに適用されます。この式は、入力データのデータ型と互換性が必要です。

### 動作原理

セーフナビゲーション演算子 (`&.`) は、入力データが有効かどうかをチェックします。入力データが `null` または未定義の場合、`null` の値を返します。入力が有効な場合、<span style="color:#FF0000">operation</span> 引数で指定された操作を実行します。これにより、`null` の値を処理するためのよりシンプルな式を記述することができます。

- Before

`to_date` 式を使用して、<kbd>Created Date</kbd> データピルを日付データ型に変換する必要があります。データピルに `null` の値が含まれている場合、式はエラーになるため、このロジックを回避するために三項式を使用する必要があります。
![Without safe navigation operator](~@img/formula-docs/safe-navigation-before.png)
_三項式を使用_

- After

代わりに `&.` 演算子を使用します。セーフナビゲーション演算子を使用すると、<kbd>Created Date</kbd> に `null` の値が含まれる場合でも、よりシンプルな式を記述することができます。
![Using safe navigation operator](~@img/formula-docs/safe-navigation-after.png)
_セーフナビゲーション演算子を使用_